---
layout: post
title: 计算机网络
date: 2018-01-21 10:12:39 +0300
description: You’ll find this post in your `_posts` directory. Go ahead and edit it and re-build the site to see your changes. # Add post description (optional)
tags: [计算机网络,  数据链路层]
---

# 计算机网络

## 第3章 数据链路层

数据链路层属于计算机网络的底层 ，该层使用的[信道][信道]主要有两种类型：

(1)**点对点信道**：使用**一对一点对点**的通信方式。

(2)**广播信道**：使用**一对多**的**广播**通信方式。

路由器在转发分组时使用的协议栈只有下面的三层：**网络层$\Rightarrow$链路层 $\Rightarrow$物理层**（并非绝对）

### 3.1 点对点通信的链路层

#### 3.1.1 数据链路和帧

所谓**链路**，就是从一个结点到相邻结点的一段物理线路，且这段物理线路中没有其他任何交换结点。(**物理链路**)

数据的传输不仅需要物理线路，还需要一些必要的通信协议来控制数据的传输。实现这些协议的**硬件**和**软件**与**物理线路(链路)**一起就构成了**数据链路**。(**逻辑链路**)

目前实现这些协议的常用方法是使用**网络适配器**，如**拨号适配器**(拨号上网)、**局域网适配器**(以太网上网)。一般的适配器都包括了数据链路层和物理层这两层的功能。

换言之，**逻辑链路**(数据链路)就是**物理链路**加上**必要的通信协议**。

**帧**——**点对点信道**的**数据链路层**的**协议数据单元**。

**IP数据报**——因特网中，**网络层协议数据单元**。(也可简称为**数据报**、**分组**和**包**)

数据链路层把网络层交下来的数据构成帧发送到链路上，并把接收到的帧中的数据取出交给网络层。

#### 3.1.2 数据链路层协议中的三个问题

基本问题: **封装成帧**、**透明传输**、**差错检测**

1. 封装成帧：在一段数据流的前后添加首部和尾部构成一个帧。

   所有在因特网上传送的数据都是以**分组**(即**IP数据报**)为**传送单位**的，这要是**分组交换**的一个重要概念。网络层的IP数据报传送到数据链路层成为帧的数据部分，在帧的数据部分的前面和后面分别加上首部和尾部，就构成了一个完整的帧。

   帧长？——数据部分的长度+首部长度+尾部长度。数据部分的长度上限为**最大传送单元**MTU(Maximum Transfer Unit)。

   首部和尾部的作用？——帧定界，即确定帧的界限。

   如何进行帧定界？

   > 数据由由可打印的ASCII码组成的文本文件：帧定界可使用特殊的帧定界符。
   >
   > 帧的开始：SOH(Start Of Header)(非字符本身，对应的十六进制编码：0x01)
   >
   > 帧的结束：EOT(End Of Transmission)(非字符本身，对应的十六进制编码：0x04)

2. 透明传输：不管所传数据是什么样的比特组合，都应当能够在链路上传送。(~~发送什么就接收什么~~只接受没错的，凡是接受的都是没出错的)

   (1)传输文本文件组成的帧时，所有字符都是从键盘上输入的可打印字符，不会出现帧定界控制字符(SOH、EOT，非打印字符)，因而所有数据都可放在帧中传输，即透明传输。

   (2)传输非ASCII码文件组成的帧时，任何比特组合都会出现，如SOH、EOT等，会导致数据链路层确定帧边界出错，丢失数据，即非透明传输。

   为解决(2)中问题，引入转义字符——**字节填充**或**字符填充**

   (1)发送端：在帧的数据部分出现控制字符SOH或EOT的前面插入转义字符ESC，出现转义字符时，则在转义字符前插入转义字符；

   (2)接收端：将数据发送网络层之前删除转义字符；

3. 差错检测：检测比特差错

   **比特差错**：比特在传输过程中产生的差错(0变成1或者1变成0)

   **误码率**：传输错误的比特占传输比特总数的比例。(BER: Bit Error Rate)，与通信链路的信噪比有较大关系。

   差错检测技术：循环冗余检测CRC(Cyclic Redundancy Check)

   >循环冗余检测CRC(Cyclic Redundancy Check)
   >
   >(1)过程：将数据分组$\rightarrow$添加n位冗余码(帧检测序列FCS：Frame Chee Sequence)$\rightarrow$连同之前的数据一起构成帧
   >
   >(2)冗余码的计算：事先商定(n+1)位除数P$\rightarrow$在数据M后面添加n位0$\rightarrow$进行模2运算$\rightarrow$得到n位余数R$\rightarrow$替换掉之前添加在数据M后n位0
   >
   >【注意】
   >
   >(1)最终k位的数据M变为k+n位，最终发送的数据位$2^nM+FCS$。
   >
   >(2)接收端将数据除以约定的除数P，若余数为0，则证明传输过程中没有差错。
   >
   >(3)可用多项式表示循环冗余检验过程，例如：
   >
   >$P(x) = X^3 + X^2 + 1$表示除数为P=1101(最高位对应于$X^3$,最高位对应于$X^0$，其中多项式 $P(X)$ 称为生成多项式。
   >
   >(4)**在数据链路层仅仅使用CRC差错检测技术，只能做到对帧的无差别接收**，可近似认为 **“凡是接收端数据链路层接受的帧均无差错”**。

   传输差错可分为两大类：

   (1)最基本的比特差错——CRC

   (2)非比特差错：**帧丢失**、**帧重复**、**帧失序**——增加**帧编号**、**确认**和**重传机制**

   当前通信线路的质量大大提高，由于通信链路质量不好引起差错的概率大大降低，故不要求数据链路层向上提供可靠传输服务(数据链路层的发送端发送什么，在接收端接受什么)，改错任务由上层协议(如运输层的TCP协议完成)，实践证明，这样可以提高通信效率，性价比更高。

### 3.2 点对点通信协议PPP(Point-to-Point Protocol)

通信线路较差的年代，在数据链路层实用可靠传输协议，如**高级数据链路控制HDLC**(High-level Data Link Control)，目前广泛使用的数据链路层通信协议是点对点协议PPP。原因见上一节。

#### 3.2.1 PPP协议特点

1. PPP协议应满足的需求

   1. **简单**：**首要需要** **提高协议的互操作性**
   2. **封装成帧**：**帧定界**
   3. **透明性**：**透明传输**
   4. **多种网络协议** ：在同一条物理链路上同时支持多种网络协议(如IP和IPX)的运行；
   5. **多种类型链路**：**串行**or**并行** **同步**or**异步** **高速**or**低俗** **电**or**光** **交换的(动态的)**or**非交换的(静态的)** 点对点链路
   6. **差错检测**：**对接受到的帧进行检测，并立即丢掉有差错的帧。**
   7. **检测链接状态**：**及时自动检测出链路是否处于正常工作状态。**
   8. **最大传输单元**：对每一种类型的点对点链路设置**MTU**的标准默认值，促进各种实现之间的互操作性。
   9. **网络层地址协商**：通信的两个网络层(两个IP层)的实体能够通过协商知道或者能够配置彼此的网络层地址。
   10. **数据压缩协商**：协商使用数据压缩算法，但不要求将数据压缩算法进行标准化。

2. PPP协议不需要的功能

   1. **纠错**：PPP协议之进行检错，即PPP协议是不可靠传输协议。纠错功能由运输层的TCP协议提供。
   2. **流量控制**：端到端的流量控制由TCP负责。
   3. **序号**：PPP不是可靠传输协议，不需要使用帧编号。
   4. **多点线路**：不支持多点线路，只支持点对点的链路通信。(因为PPP是点对点通信协议)
   5. **半双工或单工链路**：PPP协议只支持全双工链路。

3. 协议的组成：

   (1)一个将IP数据报封装到串行链路的方法。

   (2)一个用来建立、配置和测试数据链路链接的链路控制协议LCP(Link Control Protocol)。

   (3)一套网络控制协议NCP(Network Control Protocol)

#### 3.2.2 PPP协议的帧格式

1. 字段意义
2. 字节填充：异步传输
3. 零比特填充：同步传输

#### 3.2.3 PPP协议的工作状态

用户拨号接入ISP后，就建立了一条从用户PC机到ISP的物理链接。

### 3.3 使用广播信道的数据链路层

广播信道可以进行一对多的通信。

#### 3.3.1 局域网的数据链路层

局域网主要特点：网络为一个单位所拥有，且地理范围和站点数目均有限。

局域网主要优点：

(1)具有广播功能，可从一个站点很方便地访问全网。

(2)便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。

(3)提高了系统的可靠性、可用性和生存性。

局域网可按网络拓扑分为：

星形网:

环形网：令牌环形网(令牌环)

总线网：

树形网：

局域网可使用的传输媒体：双绞线、同轴电缆、光纤。

共享信道——**让更多用户能够合理而方便地共享通信媒体技术资源** ，实现方法分两类：

(1)静态的划分信道：频分复用、时分复用、波分复用、码分复用；

(2)动态媒体接入控制：又称多点接入(multiple access)：

​	随机接入：会产生碰撞(冲突)，需要有解决碰撞的网络协议。

​	受控接入：如令牌环局域网的多点线路探询(polling,轮询)。

应用较多的是采用随机接入的以太网。

1. 以太网的两个标准：

   (1)第一个版本：DIX V1(Dec Inter Xerox) 10Mb/s

   (2)第二个版本：DIX Ethernet V2(标准1) $\rightarrow$ IEEE 802.3[W-IEEE802.3]  以太网

2. 适配器的作用：连接计算机与外界局域网。

   适配器$\rightarrow$网络接口卡NIC(Network Interface Card,网卡)$\rightarrow$ 嵌入到计算机主板

#### 3.3.2 CSMA/CD 协议

